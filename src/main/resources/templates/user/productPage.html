<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="/user_inc/header :: headerFragment"></th:block>
  <div class="container" style="padding-top:150px;">
      <th:block th:if="${prod_spec=='ALL'}">
        <h4 class="w-100 mb-5 text-center">| C A T E G O R Y |</h4>
      </th:block>
      <th:block th:if="${prod_spec!='ALL'}">
        <h4 class="w-100 mb-5 text-center">| [[${prod_spec}]] |</h4>
      </th:block>
      <th:block th:if="${(category_name=='ALL')&&(prod_spec=='ALL')}">
        <h6 class="w-100 mb-5 text-center">푸드 구성상품을 둘러보세요</h6>
      </th:block>
      <th:block th:if="${(category_name=='ALL')&&(prod_spec!='ALL')}">
        <h6 class="w-100 mb-5 text-center">[[${prod_spec}]] 구성상품을 둘러보세요</h6>
      </th:block>
      <th:block th:if="${category_name!='ALL'}">
        <h6 class="w-100 mb-5 text-center">[[${category_name}]] 구성상품을 둘러보세요</h6>
      </th:block>
<!--         <h6 class="mt-3 text-center">${category_code==productList.prod_cat_code? category_name: '푸드'} 구성상품을 둘러보세요</h6>-->
      <div class="d-flex justify-content-center">
          <div class="d-flex justify-content-end" style="width : 800px;">

              <div class="dropdown">
                  <button type="button" class="btn dropdown" data-bs-toggle="dropdown">
                      정렬순 <i class="fa fa-chevron-down"></i>
                  </button>
                  <ul class="dropdown-menu">
                      <a class="dropdown-item" th:href="@{/user/productPage(category_code=${category_code},prod_spec=${prod_spec})}">추천순</a>
                      <a class="dropdown-item" th:href="@{/user/productPage(category_code=${category_code},prod_spec=${prod_spec},priceSort='LOW')}">낮은 가격순</a>
                      <a class="dropdown-item" th:href="@{/user/productPage(category_code=${category_code},prod_spec=${prod_spec},priceSort='HIGH')}">높은 가격순</a>
                  </ul>
              </div>
          </div>
      </div>
      <section class="w-100 ps-5 d-flex justify-content-center">


          <th:block th:if="${productList.size()==0}">
              <p>상품이 존재하지 않습니다.</p>
          </th:block>

          <div class="col-sm-9">
              <th:block th:if="${productList.size()!=0}">
                  <div class="d-flex mt-3 w-100" id="productpreview">
<!--                      <th:set var = "cnt" value = "0"/>-->
                      <th:block th:each="productDTO, productcnt : ${productList}">
                          <th:block th:replace="/user/productPreview"/>
                      </th:block>
                  </div>
              </th:block>
          </div>
      </section>

  </div>
<script>
$(window).scroll(()=>{
    let viewPage =1;
   let checkNum=$(window).scrollTop()-($(document).height()-$(window).height());
   console.log(checkNum);
   if(checkNum<1&& checkNum>-1){
       viewPage++;
       alert(viewPage);
       productLoad(viewPage);
   }
});
function productLoad(viewPage){

    $.ajax({
        type: 'get',
        data: {
            category_code : "[[${category_code}]]",
            prod_spec : "[[${prod_spec}]]",
            priceSort : "[[${priceSort}]]",
            viewPage : viewPage
        },
        url:"/user/productPageRoad",
        success: function(data) {
            let productViewLine = '<th:block th:each="productDTO, productcnt : ${'+data+'}">'+
                ' <th:block th:replace="/user/productPreview"/>'+
                '</th:block>';
            $('productpreview').append(productViewLine);
        },

    });
}
</script>
</body>
</html>